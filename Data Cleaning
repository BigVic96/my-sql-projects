--                -----DATA CLEANING-------

create database world_layoffs;
use world_layoffs;
select * from layoffs;
describe layoffs;

-- Removing duplicates
-- create staging table keeping the raw data for backup
create table lay_off
like layoffs;
insert lay_off
select * from layoffs;

select * from lay_off;
select *, 
row_number() over(partition by company, location, industry, total_laid_off, Percentage_laid_off, `date`, stage, country, funds_raised_millions) as row_no
from lay_off;
with duplicate_cte as
(select *,
 row_number() over(
partition by company, location, industry, total_laid_off, Percentage_laid_off, `date`, stage, country, funds_raised_millions) as row_no
from lay_off)
select * from duplicate_cte where row_no > 1;

select * from lay_off
where company = 'casper';

CREATE TABLE lay_offs2 (
  `company` text,
  `location` text,
  `industry` text,
  `total_laid_off` int DEFAULT NULL,
  `percentage_laid_off` text,
  `date` text,
  `stage` text,
  `country` text,
  `funds_raised_millions` int DEFAULT NULL,
  `row_no` int
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


insert into lay_offs2
select *, 
row_number() over(partition by company, location, industry, total_laid_off, Percentage_laid_off, `date`, stage, country, funds_raised_millions) as row_no
from lay_off;

delete 
from lay_offs2
where row_no >=2;
 -- standardizng columns
 select * from lay_offs2;
select company, 
      trim(company) as cleaned_company from lay_offs2;
update lay_offs2
set company=trim(company);

select distinct industry  from lay_offs2
order by 1;
-- where industry like 'crypto%';

update lay_offs2
set industry ='Crypto'
where industry like 'Crypto%';

select distinct country from lay_offs2
where country like 'united states%';
 select country, 
 trim(trailing '.'from country) as cleaned from lay_offs2;
 
 select * from lay_offs2
 where country like 'united states%';
 update lay_offs2
 set country =trim(trailing '.'from country)
 where country like'united states%';
 
 -- cleaning date column
select * from lay_offs2;
select `date`, str_to_date(`date`,'%m/%d/%Y')
from lay_offs2;
update lay_offs2
set `date` = str_to_date(`date`,'%m/%d/%Y');
alter table lay_offs2 modify column `date` date;
describe lay_offs2;

-- Checking Null values
select * from lay_offs2
where funds_raised_millions is null;
select * from lay_offs2
where company like 'Airbnb%';
-- update blanks to null
update lay_offs2
set industry = null
where industry = '';

select  t1.industry, t2.industry
from lay_offs2 t1 join lay_offs2 t2 on t1.company=t2.company
where t1.industry is null and t2.industry is not null;

update lay_offs2 t1 
join lay_offs2 t2 on t1.company=t2.company
set t1.industry= t2.industry
where t1.industry is null and t2.industry is not null;

select * from lay_offs2;

select *
from lay_offs2 where  total_laid_off is null and percentage_laid_off  is null;

-- removing unwanted rows
delete
from lay_offs2
where  total_laid_off is null; 

delete
from lay_offs2
where percentage_laid_off  is null;

access file


